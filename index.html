<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ShelfAssured ‚Äì Demo Prototype (Patched)</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<style>
  :root { --sa-border:#3d342f; --sa-accent:#c62828; --sa-gold:#f9a825; }
  html,body{ height:100%; }
  body { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background:#f7f3f0; color:#2d231e; }
  .app-flow-container{ display:flex; gap:1.5rem; padding:1.5rem; overflow-x:auto; scroll-behavior:smooth; }
  .app-container{ flex-shrink:0; width:100%; max-width:400px; min-height:800px; background:#fcfbf9; border:4px solid var(--sa-border); border-radius:1.25rem; box-shadow:0 4px 12px rgba(0,0,0,.08); position:relative; overflow:hidden; }
  .screen{ width:100%; height:100%; padding:1.25rem; overflow-y:auto; }
  .taskbar{ position:sticky; bottom:0; left:0; right:0; z-index:10; background:#fff; padding:1rem; border-top-left-radius:1.25rem; border-top-right-radius:1.25rem; box-shadow:0 -4px 12px rgba(0,0,0,.08); }
  .job-box{ background:#fff; border-left:4px solid var(--sa-gold); }
  .job-box.red-border{ border-left-color:#c62828; }
  .loading{ border:4px solid #eee; border-top:4px solid var(--sa-accent); border-radius:50%; width:26px; height:26px; animation:spin 1s linear infinite; }
  @keyframes spin { to { transform: rotate(360deg); } }
  .modal{ position:fixed; inset:0; background:rgba(0,0,0,.5); display:flex; align-items:center; justify-content:center; z-index:50; visibility:hidden; opacity:0; transition:opacity .25s ease; }
  .modal.is-visible{ visibility:visible; opacity:1; }
  /* Quick Admin Nav (appears when Admin mode is on) */
  .quick-nav{ position:fixed; top:10px; left:10px; z-index:60; display:none; }
  .quick-nav.show{ display:block; }
  .pill{ @apply px-3 py-1 rounded-full text-xs font-semibold; }
  .screen-title{ @apply text-3xl font-extrabold text-gray-800; }
  .btn-primary{ @apply w-full px-6 py-4 bg-red-700 text-white font-bold text-lg rounded-full shadow hover:bg-red-800 transition; }
  .btn-secondary{ @apply w-full px-6 py-4 bg-gray-200 text-gray-800 font-semibold rounded-full shadow hover:bg-gray-300 transition; }
  .small-link{ @apply text-sm text-red-700 hover:underline; }
</style>

<style id="sa-button-fallback">
  /* Button fallback to keep formatting consistent even if Tailwind hiccups */
  .sa-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 0.75rem 1rem;
    border-radius: 9999px; /* rounded-full */
    font-weight: 700;
    line-height: 1.25;
    border: 0;
    cursor: pointer;
    text-decoration: none;
  }
  /* Keep small icon-only buttons leaner */
  .sa-btn.icon { padding: 0.5rem; border-radius: 0.75rem; }
</style>

</head>
<body class="bg-gray-200">
<!-- Quick Admin Navigation (shown after Admin Login) -->
<div id="quick-nav" class="quick-nav">
  <div class="bg-white/90 backdrop-blur rounded-xl shadow p-2 border border-gray-200">
    <div class="text-xs font-bold text-gray-700 px-2 pb-1">Quick Nav (Admin)</div>
    <div class="grid grid-cols-2 gap-2 w-64">
      <button class="px-2 py-1 text-xs rounded bg-gray-100 hover:bg-gray-200" onclick="scrollToScreen('screen1')">Splash</button>
      <button class="px-2 py-1 text-xs rounded bg-gray-100 hover:bg-gray-200" onclick="scrollToScreen('screen4')">Shopper Dashboard</button>
      <button class="px-2 py-1 text-xs rounded bg-gray-100 hover:bg-gray-200" onclick="scrollToScreen('screen5')">Job Details</button>
      <button class="px-2 py-1 text-xs rounded bg-gray-100 hover:bg-gray-200" onclick="scrollToScreen('screen6')">Photo Capture</button>
      <button class="px-2 py-1 text-xs rounded bg-gray-100 hover:bg-gray-200" onclick="scrollToScreen('screen7')">Analysis</button>
      <button class="px-2 py-1 text-xs rounded bg-gray-100 hover:bg-gray-200" onclick="scrollToScreen('screen8')">Client Dashboard</button>
      <button class="px-2 py-1 text-xs rounded bg-gray-100 hover:bg-gray-200" onclick="scrollToScreen('screen13')">Client: New Job</button>
      <button class="px-2 py-1 text-xs rounded bg-gray-100 hover:bg-gray-200" onclick="scrollToScreen('screen19')">Client Snapshot</button>
      <button class="px-2 py-1 text-xs rounded bg-gray-100 hover:bg-gray-200" onclick="scrollToScreen('screen14')">Admin Dashboard</button>
      <button class="px-2 py-1 text-xs rounded bg-gray-100 hover:bg-gray-200" onclick="scrollToScreen('screen15')">Admin: Users</button>
      <button class="px-2 py-1 text-xs rounded bg-gray-100 hover:bg-gray-200" onclick="scrollToScreen('screen16')">Admin: Jobs</button>
      <button class="px-2 py-1 text-xs rounded bg-gray-100 hover:bg-gray-200" onclick="scrollToScreen('screen17')">Admin: Support</button>
      <button class="px-2 py-1 text-xs rounded bg-gray-100 hover:bg-gray-200" onclick="scrollToScreen('screen20')">Create Job (Form)</button>
    </div>
  </div>
</div>

<div class="app-flow-container">
  <!-- Screen 1: Splash / Role chooser -->
  <div class="app-container">
    <div id="screen1" class="screen flex flex-col items-center justify-center text-center">
      <div class="mb-4">
        <!-- simple logo glyph -->
        <div class="w-24 h-24 rounded-2xl bg-gradient-to-br from-gray-200 to-gray-300 border border-gray-400 flex items-center justify-center">
          <span class="text-3xl">üõí</span>
        </div>
      </div>
      <h1 class="text-4xl font-extrabold text-[#424242]">Shelf<span class="text-[var(--sa-gold)]">Assured</span></h1>
      <p class="mt-4 text-lg text-gray-700 max-w-xs">Helping emerging brands see their products on shelves in real time.</p>
      <div class="mt-10 w-full space-y-3">
        <button class="btn-primary" onclick="scrollToScreen('screen2')">Create Account</button>
        <button class="btn-secondary" onclick="scrollToScreen('screen3')">Sign In</button>
        <button class="btn-secondary" onclick="scrollToScreen('screen8')">Client Login</button>
        <button class="btn-secondary" onclick="enableAdminMode()">Admin Login</button>
        <p class="text-xs text-gray-500 mt-2">By continuing, you agree to our <a href="#" class="text-red-700 underline underline-offset-2">Terms</a>.</p>
      </div>
    </div>
  </div>

  <!-- Screen 2: Create Account -->
  <div class="app-container">
    <div id="screen2" class="screen flex flex-col justify-center">
      <h2 class="screen-title text-center">Create Account</h2>
      <p class="text-center text-gray-500 mb-6">Choose a method to get started.</p>
      <div class="space-y-3">
        <button class="w-full flex items-center justify-center gap-3 bg-white border border-gray-300 rounded-full py-3 shadow">
          <span class="text-lg">üîê</span><span>Sign in with Google</span>
        </button>
        <div class="flex items-center gap-2">
          <hr class="flex-1 border-gray-300"/><span class="text-xs text-gray-500">OR</span><hr class="flex-1 border-gray-300"/>
        </div>
        <button class="btn-secondary" onclick="scrollToScreen('screen11')">Continue with Email</button>
        <div class="text-center mt-3">
          <button class="small-link" onclick="scrollToScreen('screen1')">Back to Splash</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Screen 3: Sign In -->
  <div class="app-container">
    <div id="screen3" class="screen flex flex-col justify-between">
      <div>
        <h2 class="text-2xl font-bold text-gray-800 mb-2">Welcome Back!</h2>
        <p class="text-gray-500 mb-4">Sign in to your account.</p>
        <div class="space-y-3">
          <div>
            <label class="block text-sm font-medium">Email</label>
            <input type="email" class="mt-1 w-full border rounded px-3 py-2" />
          </div>
          <div>
            <label class="block text-sm font-medium">Password</label>
            <input type="password" class="mt-1 w-full border rounded px-3 py-2" />
          </div>
          <button class="btn-primary" onclick="scrollToScreen('screen4')">Sign In</button>
        </div>
      </div>
      <div class="text-center">
        <span class="text-sm text-gray-500">No account?</span>
        <button class="small-link ml-1" onclick="scrollToScreen('screen2')">Sign up</button>
      </div>
    </div>
  </div>

  <!-- Screen 4: Shopper Dashboard -->
  <div class="app-container">
    <div id="screen4" class="screen flex flex-col">
      <div>
        <h2 class="screen-title">Hello, Courtney!</h2>
        <p class="text-gray-500">Your ShelfAssured Dashboard</p>

        <div class="grid grid-cols-2 gap-3 mt-5">
          <div class="bg-white p-4 rounded-xl shadow border-l-4 border-gray-400">
            <p class="text-xs text-gray-500">Total Income</p>
            <p id="total-income" class="text-2xl font-bold">$15.00</p>
          </div>
          <div class="bg-white p-4 rounded-xl shadow border-l-4 border-[var(--sa-accent)]">
            <p class="text-xs text-gray-500">Current Jobs</p>
            <p class="text-2xl font-bold">4</p>
          </div>
        </div>

        <div class="mt-5" id="jobs-section">
          <div class="flex items-center justify-between">
            <h3 class="text-xl font-bold">Jobs Near You</h3>
            <button class="text-sm text-red-700 hover:underline">Filter</button>
          </div>
          <div id="jobs-dynamic" class="mt-3 space-y-3"></div>

          <!-- Static store block -->
          <div class="bg-gray-200 p-3 rounded text-sm font-medium text-gray-700 mt-4">
            Whole Foods Market - 10133 Louetta Rd, Houston, TX 77070
          </div>
          <div class="job-box p-4 rounded-xl shadow cursor-pointer hover:shadow-lg"
               onclick="showLocationModal('Whole Foods Market - 10133 Louetta Rd, Houston, TX 77070')">
            <p class="font-bold">Rambler Sparkling Water</p>
            <p class="text-sm text-gray-500 mt-1">Take and upload 2 photos</p>
            <p class="text-sm font-semibold text-[var(--sa-gold)] mt-2">Earn $3.00</p>
          </div>
        </div>
      </div>

      <div class="taskbar mt-auto">
        <div class="flex justify-around text-gray-500">
          <button class="flex flex-col items-center text-[var(--sa-accent)] font-bold">
            <span>üè†</span><span class="text-xs mt-1">Dashboard</span>
          </button>
          <button class="flex flex-col items-center hover:text-[var(--sa-accent)]" onclick="scrollToScreen('screen9')">
            <span>üìù</span><span class="text-xs mt-1">Jobs</span>
          </button>
          <button class="flex flex-col items-center hover:text-[var(--sa-accent)]" onclick="scrollToScreen('screen10')">
            <span>üè∑Ô∏è</span><span class="text-xs mt-1">Brands</span>
          </button>
          <button class="flex flex-col items-center hover:text-[var(--sa-accent)]" onclick="scrollToScreen('screen11')">
            <span>üë§</span><span class="text-xs mt-1">Profile</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Screen 5: Job Details -->
  <div class="app-container">
    <div id="screen5" class="screen flex flex-col">
      <button class="text-gray-500 hover:text-gray-700 w-10" onclick="scrollToScreen('screen4')">‚Üê</button>
      <h2 id="job-title" class="text-3xl font-bold mt-2">Rambler Sparkling Water</h2>
      <p id="job-store" class="text-gray-500">Whole Foods Market</p>
      <p id="job-payout" class="text-2xl font-bold text-[var(--sa-gold)] mt-3">$3.00</p>

      <div class="mt-5">
        <h3 class="text-xl font-bold">Job Instructions</h3>
        <p class="text-sm text-gray-500 mt-1">Follow these steps carefully to complete the job and get paid.</p>
        <ul class="mt-3 space-y-2 text-gray-700">
          <li>‚úî Go to the beverage aisle.</li>
          <li>‚úî Take a photo of the shelf section.</li>
          <li>‚úî Take a photo of the product tag (price + barcode readable).</li>
        </ul>
      </div>

      <div class="mt-5 bg-white p-4 rounded-xl shadow border">
        <label for="price-input" class="block text-sm font-medium text-gray-700">Confirm Shelf Price</label>
        <div class="mt-1 relative rounded-md shadow-sm">
          <div class="pointer-events-none absolute inset-y-0 left-0 pl-3 flex items-center">$</div>
          <input id="price-input" type="text" inputmode="decimal" pattern="\\d+(\\.\\d{1,2})?"
                 class="block w-full pl-7 pr-12 sm:text-sm border-gray-300 rounded-md focus:ring-red-500 focus:border-red-500"
                 placeholder="2.99" aria-describedby="price-help"/>
          <div class="absolute inset-y-0 right-0 flex items-center pr-3">USD</div>
        </div>
        <p id="price-help" class="text-xs text-gray-500 mt-2">Enter the price shown on the <b>shelf tag</b> (e.g., 2.99).</p>
      </div>

      <button class="btn-primary mt-5" onclick="capturePriceAndProceed()">Start Job</button>
    </div>
  </div>

  <!-- Screen 6: Photo Capture -->
  <div class="app-container">
    <div id="screen6" class="screen flex flex-col items-center">
      <button class="self-start text-gray-400 hover:text-gray-700" onclick="scrollToScreen('screen5')">‚Üê Back</button>
      <div class="mt-4 w-full max-w-sm bg-white text-black p-4 rounded-lg shadow">
        <div class="flex items-center justify-between mb-2">
          <label class="block text-sm font-medium">Photo Input Mode</label>
          <button id="mode-toggle" class="px-2 py-1 border rounded text-xs" onclick="togglePhotoMode()">Use Auto Demo</button>
        </div>
        <div id="upload-block">
          <label class="block text-sm font-medium mb-2">Upload or take a photo</label>
          <input id="photo-input" type="file" accept="image/*" capture="environment" class="block w-full text-sm"/>
        </div>
        <div id="photo-preview" class="mt-3 w-full h-40 bg-gray-200 rounded-md flex items-center justify-center text-gray-500">
          No photo selected
        </div>
        <button class="mt-4 w-full px-4 py-2 bg-red-700 text-white font-semibold rounded-md hover:bg-red-800" onclick="proceedToAnalysis()">Use This Photo</button>
        <p class="text-xs text-gray-600 mt-2">Tip: Auto Demo loads a sample image for quick walkthroughs.</p>
      </div>
      <div class="flex-1 flex flex-col items-center justify-center mt-6">
        <div class="w-24 h-24 mb-3 rounded-full bg-gray-600/70 flex items-center justify-center text-gray-200">üì∑</div>
        <h2 class="text-lg font-bold">Take Photo 1 of 2</h2>
        <p class="text-gray-500 text-sm">Shelf Section</p>
      </div>
    </div>
  </div>

  <!-- Screen 7: Uploading & Analysis -->
  <div class="app-container">
    <div id="screen7" class="screen flex flex-col items-center justify-center text-center">
      <div class="loading"></div>
      <h2 class="text-lg font-bold mt-4">Uploading &amp; Analyzing...</h2>
      <p class="text-gray-500 max-w-xs mt-1">Fantastic! Let's see if we got everything we need. This should only take a few seconds.</p>

      <div class="mt-5 bg-white p-4 rounded-xl shadow border-l-4 border-[var(--sa-accent)] w-full max-w-sm text-left">
        <p class="font-bold">Checking...</p>
        <p class="text-sm text-gray-600 mt-1">‚úì Proper lighting</p>
        <p class="text-sm text-gray-600">‚úì In-focus</p>
        <p class="text-sm text-gray-600">‚úì Visible product</p>
      </div>

      <div id="vision-analysis" class="mt-4 bg-white p-4 rounded-xl shadow border text-left w-full max-w-sm">
        <div class="flex items-center justify-between">
          <h3 class="font-bold">Vision Analysis (beta)</h3>
          <button id="vision-btn" class="text-sm border px-3 py-1 rounded" onclick="runVisionAnalysis()">Analyze This Photo</button>
        </div>
        <p class="text-xs text-gray-600 mt-1">Prototype-only: click <b>Analyze This Photo</b> to populate a structured summary.</p>
        <div id="vision-results" class="mt-3 text-sm text-gray-800"></div>
      </div>

      <div class="flex gap-2 w-full max-w-sm mt-5">
        <button class="flex-1 px-4 py-3 rounded-full bg-gray-200 text-gray-800 font-semibold hover:bg-gray-300" onclick="scrollToScreen('screen5')">Back</button>
        <button class="flex-1 px-4 py-3 rounded-full bg-red-700 text-white font-bold hover:bg-red-800" onclick="submitJob()">Submit for Review</button>
      </div>
    </div>
  </div>

  <!-- Screen 8: Client Dashboard -->
  <div class="app-container">
    <div id="screen8" class="screen flex flex-col">
      <div>
        <h2 class="screen-title">Client Dashboard</h2>
        <p class="text-gray-500">Real-time data at your fingertips</p>

        <div class="grid grid-cols-2 gap-3 mt-5">
          <div class="bg-white p-4 rounded-xl shadow border-l-4 border-blue-500">
            <p class="text-xs text-gray-500">Shelf Presence Score</p>
            <p class="text-2xl font-bold">89%</p>
            <p class="text-[10px] text-gray-500 mt-1">Planogram ¬∑ Facings ¬∑ Tidiness</p>
          </div>
          <div class="bg-white p-4 rounded-xl shadow border-l-4 border-[var(--sa-accent)]">
            <p class="text-xs text-gray-500">Out-of-Stock Alerts</p>
            <p class="text-2xl font-bold">üö®</p>
            <p class="text-[10px] text-gray-500 mt-1">Whole Foods, Houston</p>
          </div>
        </div>

        <div class="mt-5 bg-white p-4 rounded-xl shadow">
          <h3 class="text-xl font-bold">Recent Audits</h3>
          <p class="text-sm text-gray-500">Latest photos from your team</p>
          <div class="mt-3 grid grid-cols-3 gap-2">
            <div class="w-full h-20 bg-gray-200 rounded-lg"></div>
            <div class="w-full h-20 bg-gray-200 rounded-lg"></div>
            <div class="w-full h-20 bg-gray-200 rounded-lg"></div>
            <div class="w-full h-20 bg-gray-200 rounded-lg"></div>
            <div class="w-full h-20 bg-gray-200 rounded-lg"></div>
            <div class="w-full h-20 bg-gray-200 rounded-lg"></div>
          </div>
        </div>
      </div>

      <button class="btn-secondary mt-4" onclick="scrollToScreen('screen13')">Create New Job</button>

      <div class="mt-4 bg-white p-4 rounded-xl shadow border-l-4 border-green-600">
        <p class="text-xs text-gray-500">Latest Reported Shelf Price</p>
        <p class="text-2xl font-bold">$<span id="reported-price">‚Äî</span></p>
        <p class="text-[11px] text-gray-500"><span id="reported-price-location">Location pending</span></p>
      </div>

      <div class="mt-3 grid grid-cols-2 gap-2">
        <button class="w-full px-6 py-3 bg-gray-800 text-white font-semibold rounded-full hover:bg-black"
                onclick="scrollToScreen('screen19'); buildReportFromState(); injectReportAnalysis();">Open Client Snapshot</button>
        <button class="w-full px-6 py-3 border rounded-full" onclick="scrollToScreen('screen1')">Back to Splash</button>
      </div>

      <div class="mt-4 bg-white p-4 rounded-xl shadow">
        <div class="flex items-center justify-between">
          <h3 class="text-xl font-bold">Jobs Map</h3>
          <button class="text-sm border px-2 py-1 rounded" onclick="toggleMapMode()">Toggle Live Map</button>
        </div>
        <div id="map-static" class="mt-3">
          <div class="w-full h-48 rounded bg-gray-200 flex items-center justify-center text-gray-600">Map Placeholder</div>
          <p class="text-[11px] text-gray-500 mt-1">Static placeholder. Toggle for live map (internet required).</p>
        </div>
        <div id="map-live" class="hidden mt-3">
          <iframe class="w-full h-48 rounded" loading="lazy" src="https://www.google.com/maps?q=Houston,+TX&output=embed"></iframe>
        </div>
      </div>
    </div>
  </div>

  <!-- Screen 9: Shopper Jobs List -->
  <div class="app-container">
    <div id="screen9" class="screen flex flex-col">
      <h2 class="screen-title">My Jobs</h2>
      <p class="text-gray-500">View your current and completed tasks</p>
      <div class="mt-5 space-y-3">
        <div class="bg-white p-4 rounded-xl shadow border-l-4 border-green-500">
          <p class="font-bold">Rambler Sparkling Water</p>
          <p class="text-sm text-gray-500 mt-1">Completed at Whole Foods Market</p>
          <p class="text-green-600 font-semibold text-sm mt-2">Earned $3.00</p>
        </div>
        <div class="bg-white p-4 rounded-xl shadow border-l-4 border-yellow-500">
          <p class="font-bold">Neutral Milk</p>
          <p class="text-sm text-gray-500 mt-1">In progress at Whole Foods Market</p>
          <p class="text-yellow-600 font-semibold text-sm mt-2">Est. $3.00</p>
        </div>
      </div>

      <div class="taskbar mt-auto">
        <div class="flex justify-around text-gray-500">
          <button class="flex flex-col items-center hover:text-[var(--sa-accent)]" onclick="scrollToScreen('screen4')">
            <span>üè†</span><span class="text-xs mt-1">Dashboard</span>
          </button>
          <button class="flex flex-col items-center text-[var(--sa-accent)] font-bold">
            <span>üìù</span><span class="text-xs mt-1">Jobs</span>
          </button>
          <button class="flex flex-col items-center hover:text-[var(--sa-accent)]" onclick="scrollToScreen('screen10')">
            <span>üè∑Ô∏è</span><span class="text-xs mt-1">Brands</span>
          </button>
          <button class="flex flex-col items-center hover:text-[var(--sa-accent)]" onclick="scrollToScreen('screen11')">
            <span>üë§</span><span class="text-xs mt-1">Profile</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Screen 10: Brands -->
  <div class="app-container">
    <div id="screen10" class="screen flex flex-col">
      <h2 class="screen-title">Brands</h2>
      <p class="text-gray-500">Explore participating brands & offers</p>
      <div class="mt-5 grid grid-cols-2 gap-3">
        <div class="bg-white p-4 rounded-xl shadow text-center cursor-pointer" onclick="scrollToScreen('screen12'); updateBrandBio('Rambler Sparkling Water','Texas-based sparkling water with a crisp, clean profile.')">
          <div class="w-20 h-20 mx-auto rounded-full bg-gray-200 flex items-center justify-center text-gray-400">R</div>
          <p class="font-bold mt-2">Rambler Sparkling Water</p>
          <p class="text-xs text-[var(--sa-gold)]">Save 10%</p>
        </div>
        <div class="bg-white p-4 rounded-xl shadow text-center cursor-pointer" onclick="scrollToScreen('screen12'); updateBrandBio('Peet\\'s Coffee','Specialty coffee known for rich, deep flavors.')">
          <div class="w-20 h-20 mx-auto rounded-full bg-gray-200 flex items-center justify-center text-gray-400">PC</div>
          <p class="font-bold mt-2">Peet's Coffee</p>
          <p class="text-xs text-[var(--sa-gold)]">Explore</p>
        </div>
      </div>

      <div class="taskbar mt-auto">
        <div class="flex justify-around text-gray-500">
          <button class="flex flex-col items-center hover:text-[var(--sa-accent)]" onclick="scrollToScreen('screen4')">
            <span>üè†</span><span class="text-xs mt-1">Dashboard</span>
          </button>
          <button class="flex flex-col items-center hover:text-[var(--sa-accent)]" onclick="scrollToScreen('screen9')">
            <span>üìù</span><span class="text-xs mt-1">Jobs</span>
          </button>
          <button class="flex flex-col items-center text-[var(--sa-accent)] font-bold">
            <span>üè∑Ô∏è</span><span class="text-xs mt-1">Brands</span>
          </button>
          <button class="flex flex-col items-center hover:text-[var(--sa-accent)]" onclick="scrollToScreen('screen11')">
            <span>üë§</span><span class="text-xs mt-1">Profile</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Screen 11: Profile -->
  <div class="app-container">
    <div id="screen11" class="screen flex flex-col">
      <h2 class="screen-title">My Profile</h2>
      <p class="text-gray-500">Account settings & information</p>
      <div class="mt-5 space-y-3">
        <div class="bg-white p-4 rounded-xl shadow border-l-4 border-gray-400">
          <p class="font-bold">Total Earnings</p>
          <p class="text-2xl font-bold">$15.00</p>
        </div>
        <div class="bg-white p-4 rounded-xl shadow border-l-4 border-gray-400">
          <p class="font-bold">Jobs Completed</p>
          <p class="text-2xl font-bold">2</p>
        </div>
      </div>

      <div class="taskbar mt-auto">
        <div class="flex justify-around text-gray-500">
          <button class="flex flex-col items-center hover:text-[var(--sa-accent)]" onclick="scrollToScreen('screen4')">
            <span>üè†</span><span class="text-xs mt-1">Dashboard</span>
          </button>
          <button class="flex flex-col items-center hover:text-[var(--sa-accent)]" onclick="scrollToScreen('screen9')">
            <span>üìù</span><span class="text-xs mt-1">Jobs</span>
          </button>
          <button class="flex flex-col items-center hover:text-[var(--sa-accent)]" onclick="scrollToScreen('screen10')">
            <span>üè∑Ô∏è</span><span class="text-xs mt-1">Brands</span>
          </button>
          <button class="flex flex-col items-center text-[var(--sa-accent)] font-bold">
            <span>üë§</span><span class="text-xs mt-1">Profile</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Screen 12: Brand Bio -->
  <div class="app-container">
    <div id="screen12" class="screen flex flex-col">
      <button class="text-gray-500 hover:text-gray-700 w-10" onclick="scrollToScreen('screen10')">‚Üê</button>
      <h2 id="brand-bio-title" class="screen-title mt-2"></h2>
      <p id="brand-bio-text" class="text-gray-600 mt-3"></p>
      <button class="btn-secondary mt-5" onclick="scrollToScreen('screen10')">Back to Brands</button>
    </div>
  </div>

  <!-- Screen 13: Client ‚Äì Create New Job (tier picker) -->
  <div class="app-container">
    <div id="screen13" class="screen flex flex-col">
      <h2 class="screen-title">Create New Job</h2>
      <p class="text-gray-500">Pick the best option for your needs</p>
      <div class="mt-5 space-y-3">
        <div class="bg-white p-4 rounded-xl shadow border-l-4 border-green-500">Standard Check ‚Äî core photos within 48h</div>
        <div class="bg-white p-4 rounded-xl shadow border-l-4 border-yellow-500">Launch Day Bundle ‚Äî multiple stores within 24h</div>
        <div class="bg-white p-4 rounded-xl shadow border-l-4 border-red-500">Rush Audit ‚Äî urgent photos within 6h</div>
      </div>
      <div class="mt-5 space-y-2">
        <button class="btn-secondary" onclick="scrollToScreen('screen20')">Open Full Job Form</button>
        <button class="btn-secondary" onclick="scrollToScreen('screen8')">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Screen 14: Admin Dashboard -->
  <div class="app-container">
    <div id="screen14" class="screen flex flex-col">
      <h2 class="screen-title">Admin Dashboard</h2>
      <p class="text-gray-500">Platform-wide oversight</p>
      <div class="mt-5 space-y-3">
        <div class="bg-white p-4 rounded-xl shadow border-l-4 border-gray-400 flex items-center justify-between">
          <div>
            <p class="font-bold">New User Sign-ups</p>
            <p class="text-2xl font-bold">5</p>
          </div>
          <button class="small-link" onclick="scrollToScreen('screen15')">Review</button>
        </div>
        <div class="bg-white p-4 rounded-xl shadow border-l-4 border-[var(--sa-gold)] flex items-center justify-between">
          <div>
            <p class="font-bold">Jobs to Approve</p>
            <p class="text-2xl font-bold">3</p>
          </div>
          <button class="small-link" onclick="scrollToScreen('screen16')">Review</button>
        </div>
        <div class="bg-white p-4 rounded-xl shadow border-l-4 border-red-500 flex items-center justify-between">
          <div>
            <p class="font-bold">Support Requests</p>
            <p class="text-2xl font-bold">1</p>
          </div>
          <button class="small-link" onclick="scrollToScreen('screen17')">View</button>
        </div>
      </div>
      <div class="mt-4 grid grid-cols-2 gap-2">
        <button class="btn-secondary" onclick="scrollToScreen('screen1')">Back to Splash</button>
        <button class="btn-secondary" onclick="scrollToScreen('screen20')">Create Job (Form)</button>
      </div>
    </div>
  </div>

  <!-- Screen 15: Admin ‚Äì User Approval -->
  <div class="app-container">
    <div id="screen15" class="screen flex flex-col">
      <h2 class="screen-title">Review New Users</h2>
      <p class="text-gray-500">Approve or deny new gig workers</p>
      <div class="mt-5 bg-white p-4 rounded-xl shadow border-l-4 border-gray-400">
        <p class="font-bold">New User: Jane Doe</p>
        <p class="text-sm text-gray-500">Joined: Aug 28, 2025 ‚Äî Houston, TX</p>
        <div class="mt-3 flex gap-2">
          <button class="px-4 py-2 rounded-full bg-green-600 text-white text-sm">Approve</button>
          <button class="px-4 py-2 rounded-full bg-red-600 text-white text-sm">Deny</button>
        </div>
      </div>
      <button class="btn-secondary mt-4" onclick="scrollToScreen('screen14')">Back to Admin Dashboard</button>
    </div>
  </div>

  <!-- Screen 16: Admin ‚Äì Job Approval -->
  <div class="app-container">
    <div id="screen16" class="screen flex flex-col">
      <h2 class="screen-title">Review Job Submissions</h2>
      <p class="text-gray-500">Approve or reject job photos</p>
      <div class="mt-5 bg-white p-4 rounded-xl shadow border-l-4 border-[var(--sa-gold)]">
        <p class="font-bold">Job: Peet's Coffee</p>
        <p class="text-sm text-gray-500">User: Jane Doe | H‚ÄëE‚ÄëB, Bridgeland</p>
        <div class="grid grid-cols-3 gap-2 mt-3">
          <div class="h-28 rounded bg-gray-200 flex items-center justify-center text-xs text-gray-500">Aisle View</div>
          <div class="h-28 rounded bg-gray-200 flex items-center justify-center text-xs text-gray-500">Shelf View</div>
          <div class="h-28 rounded bg-gray-200 flex items-center justify-center text-xs text-gray-500">Price Tag</div>
        </div>
        <div class="mt-3 flex gap-2">
          <button class="px-4 py-2 rounded-full bg-green-600 text-white text-sm">Approve</button>
          <button class="px-4 py-2 rounded-full bg-red-600 text-white text-sm">Reject</button>
        </div>
      </div>
      <button class="btn-secondary mt-4" onclick="scrollToScreen('screen14')">Back to Admin Dashboard</button>
    </div>
  </div>

  <!-- Screen 17: Admin ‚Äì Support -->
  <div class="app-container">
    <div id="screen17" class="screen flex flex-col">
      <h2 class="screen-title">Support Requests</h2>
      <p class="text-gray-500">View and respond to user help requests</p>
      <div class="mt-5 bg-white p-4 rounded-xl shadow border-l-4 border-red-500">
        <p class="font-bold">Support: John Doe</p>
        <p class="text-sm text-gray-500">Peet's Coffee @ H‚ÄëE‚ÄëB Bridgeland</p>
        <p class="mt-2">"My photos keep getting rejected. I can't figure out why."</p>
        <div class="mt-3 flex gap-2">
          <button class="px-4 py-2 rounded-full bg-blue-600 text-white text-sm">Reply</button>
          <button class="px-4 py-2 rounded-full bg-gray-300 text-gray-800 text-sm">Resolve</button>
        </div>
      </div>
      <button class="btn-secondary mt-4" onclick="scrollToScreen('screen14')">Back to Admin Dashboard</button>
    </div>
  </div>

  <!-- Screen 19: Client Snapshot -->
  <div class="app-container">
    <div id="screen19" class="screen">
      <div class="max-w-2xl mx-auto bg-white rounded-xl shadow p-6 print:shadow-none">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-2xl font-extrabold">ShelfAssured ‚Äî Client Snapshot</h2>
          <div class="flex gap-2">
            <button class="px-3 py-2 border rounded-md" onclick="scrollToScreen('screen8')">Back to Client</button>
            <button class="px-3 py-2 bg-[var(--sa-accent)] text-white rounded-md" onclick="window.print()">Print / Save PDF</button>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-4">
          <div class="bg-gray-50 p-3 rounded">
            <p class="text-xs text-gray-500">Brand</p>
            <p id="report-brand" class="font-semibold">‚Äî</p>
          </div>
          <div class="bg-gray-50 p-3 rounded">
            <p class="text-xs text-gray-500">Store</p>
            <p id="report-store" class="font-semibold">‚Äî</p>
          </div>
          <div class="bg-gray-50 p-3 rounded">
            <p class="text-xs text-gray-500">Reported Shelf Price</p>
            <p id="report-price" class="font-semibold">‚Äî</p>
          </div>
          <div class="bg-gray-50 p-3 rounded">
            <p class="text-xs text-gray-500">Submitted</p>
            <p id="report-date" class="font-semibold">‚Äî</p>
          </div>
        </div>
        <div class="mt-5">
          <p class="font-semibold text-gray-700 mb-2">Photos</p>
          <div id="report-photos" class="grid grid-cols-3 gap-2"></div>
        </div>
        <div class="mt-5">
          <p class="font-semibold text-gray-700 mb-2">Analysis Summary</p>
          <div id="report-analysis" class="text-sm text-gray-800 bg-gray-50 p-3 rounded">No analysis captured yet. Use <b>Analyze This Photo</b> on the Analysis screen.</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Screen 20: Create New Job (form) -->
  <div class="app-container">
    <div id="screen20" class="screen">
      <div class="max-w-2xl mx-auto bg-white rounded-xl shadow p-6">
        <h2 class="text-2xl font-extrabold mb-4">Create New Job</h2>
        <div class="grid grid-cols-1 gap-4">
          <div>
            <label class="block text-sm font-medium">Product / Brand</label>
            <input id="cj-brand" type="text" class="mt-1 w-full border rounded px-3 py-2" placeholder="e.g., Rambler Sparkling Water"/>
          </div>
          <div>
            <label class="block text-sm font-medium">Store</label>
            <input id="cj-store" list="store-options" type="text" class="mt-1 w-full border rounded px-3 py-2" placeholder="Start typing a store..."/>
            <datalist id="store-options">
              <option>Whole Foods Market - 10133 Louetta Rd, Houston, TX 77070</option>
              <option>H-E-B - 28520 Tomball Pkwy, Houston, TX 77070</option>
              <option>Sprouts Farmers Market - 22506 Tomball Pkwy, Houston, TX 77375</option>
              <option>Central Market - 3815 Westheimer Rd, Houston, TX 77027</option>
              <option>Whole Foods Market - Kensington High St, London W8 6NA, UK</option>
            </datalist>
          </div>
          <div>
            <label class="block text-sm font-medium">Job Type</label>
            <div class="mt-1 space-y-2">
              <label class="flex items-center gap-2"><input type="radio" name="cj-type" value="standard" checked/> <span>Standard Check ‚Äî core photos within 48h</span></label>
              <label class="flex items-center gap-2"><input type="radio" name="cj-type" value="launch"/> <span>Launch Day Bundle ‚Äî multiple stores within 24h</span></label>
              <label class="flex items-center gap-2"><input type="radio" name="cj-type" value="rush"/> <span>Rush Audit ‚Äî urgent photos within 6h</span></label>
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium">Photo Instructions</label>
            <textarea id="cj-notes" rows="4" class="mt-1 w-full border rounded px-3 py-2" placeholder="e.g., Take an up-close photo of the product tag (price + barcode must be readable)."></textarea>
          </div>
          <div class="flex gap-3">
            <button class="px-4 py-2 bg-[var(--sa-accent)] text-white rounded-md" onclick="publishJob()">Publish Job</button>
            <button class="px-4 py-2 border rounded-md" onclick="scrollToScreen('screen8')">Cancel</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div><!-- /app-flow-container -->

<!-- Modals -->
<div id="location-modal" class="modal">
  <div class="bg-white p-6 rounded-2xl shadow-xl w-80 text-center">
    <h3 class="text-xl font-bold mb-2">Confirm Your Location</h3>
    <p class="text-sm text-gray-600">To confirm you're at the correct store, we need to check your current location.</p>
    <p id="location-modal-text" class="text-sm text-red-600 mt-3 hidden">It looks like you're not at the correct store. Please try again when you arrive.</p>
    <div class="mt-4 flex justify-center gap-3">
      <button class="px-4 py-2 rounded-full bg-[var(--sa-accent)] text-white" onclick="confirmLocation()">Confirm Location</button>
      <button class="px-4 py-2 rounded-full border" onclick="hideModal('location-modal')">Cancel</button>
    </div>
  </div>
</div>

<script>
/* ---------- Core state & helpers ---------- */
const SA = {
  earningsKey: 'sa_earnings_cents',
  jobsKey: 'sa_jobs_completed',
  priceKey: 'sa_last_price',
  storeKey: 'sa_last_store',
  brandKey: 'sa_last_brand',
  photoKey: 'sa_last_photo',
  submittedAtKey: 'sa_last_submitted_at',
  adminKey: 'sa_admin_mode',
};

function scrollToScreen(id){
  const el = document.getElementById(id);
  if (el) el.scrollIntoView({behavior:'smooth', block:'start'});
}

function showLocationModal(storeName){
  window._targetStore = storeName || '';
  document.getElementById('location-modal').classList.add('is-visible');
}
function hideModal(id){ document.getElementById(id)?.classList.remove('is-visible'); }
function confirmLocation(){
  hideModal('location-modal');
  if (window._targetStore){
    try { localStorage.setItem(SA.storeKey, window._targetStore); } catch(e){}
  }
  updateJobDetailsUI();
  scrollToScreen('screen5');
}

function updateBrandBio(title, text){
  const t = document.getElementById('brand-bio-title');
  const b = document.getElementById('brand-bio-text');
  if (t) t.textContent = title || '';
  if (b) b.textContent = text || '';
}

/* ---------- Price capture patch ---------- */
function normalizePrice(raw){
  if (raw == null) return null;
  let s = String(raw).replace(/[^\d.,]/g,'').trim();
  if (!s) return null;
  if (s.includes(',') && s.includes('.')) s = s.replace(/,/g,'');
  else if (s.includes(',')) s = s.replace(',', '.');
  const n = parseFloat(s);
  if (isNaN(n)) return null;
  return n.toFixed(2);
}
function capturePriceAndProceed(){
  const el = document.getElementById('price-input');
  const raw = el ? el.value : '';
  const norm = normalizePrice(raw);
  if (norm == null){
    alert('Please enter a valid shelf price, e.g., 2.99');
    if (el) el.focus();
    return;
  }
  try {
    localStorage.setItem('sa_price', norm);
    localStorage.setItem(SA.priceKey, norm);
  } catch(e){}
  scrollToScreen('screen6');
}

/* ---------- Submit flow (uses saved price) ---------- */
(function(){
  const _orig = window.submitJob;
  window.submitJob = function(){
    let price = localStorage.getItem('sa_price') || localStorage.getItem(SA.priceKey) || '';
    price = normalizePrice(price);
    if (price == null){
      alert('Please enter a valid shelf price on the Job Instructions screen.');
      scrollToScreen('screen5');
      setTimeout(()=>document.getElementById('price-input')?.focus(), 350);
      return;
    }
    // Save keys
    try {
      localStorage.setItem('sa_price', price);
      localStorage.setItem(SA.priceKey, price);
      localStorage.setItem(SA.brandKey, localStorage.getItem('sa_current_job_brand') || 'Rambler Sparkling Water');
      localStorage.setItem(SA.submittedAtKey, String(Date.now()));
      // earnings + jobs
      const cents = parseInt(localStorage.getItem(SA.earningsKey) || '1500', 10);
      localStorage.setItem(SA.earningsKey, String(cents + 300));
      const jobs = parseInt(localStorage.getItem(SA.jobsKey) || '2', 10);
      localStorage.setItem(SA.jobsKey, String(jobs + 1));
    } catch(e){}
    syncClientUI();
    scrollToScreen('screen9');
    if (_orig) return _orig();
  };
})();

/* ---------- Photo handling (demo) ---------- */
let autoDemoMode = false;
function togglePhotoMode(){
  autoDemoMode = !autoDemoMode;
  const btn = document.getElementById('mode-toggle');
  const up = document.getElementById('upload-block');
  if (btn) btn.textContent = autoDemoMode ? 'Use Upload Mode' : 'Use Auto Demo';
  if (up) up.style.display = autoDemoMode ? 'none' : 'block';
  if (autoDemoMode){
    const preview = document.getElementById('photo-preview');
    if (preview){
      preview.innerHTML = '';
      const ph = document.createElement('div');
      ph.className = 'w-full h-40 rounded bg-[conic-gradient(at_top_left,_#ddd,_#bbb)] flex items-center justify-center text-gray-600';
      ph.textContent = 'Demo Photo';
      preview.appendChild(ph);
    }
    try { localStorage.setItem(SA.photoKey, 'demo'); } catch(e){}
  }
}
document.addEventListener('change', (e)=>{
  if (e.target && e.target.id === 'photo-input' && e.target.files?.[0]){
    const reader = new FileReader();
    reader.onload = (ev)=>{
      const preview = document.getElementById('photo-preview');
      if (preview){
        preview.innerHTML='';
        const img = document.createElement('img');
        img.src = ev.target.result;
        img.className = 'max-h-40 object-contain';
        preview.appendChild(img);
      }
      try { localStorage.setItem(SA.photoKey, ev.target.result); } catch(e){}
    };
    reader.readAsDataURL(e.target.files[0]);
  }
});
function proceedToAnalysis(){
  const preview = document.getElementById('photo-preview');
  const img = preview ? preview.querySelector('img') : null;
  if (img){ try { localStorage.setItem(SA.photoKey, img.src); } catch(e){} }
  scrollToScreen('screen7');
}

/* ---------- Vision analysis (demo placeholder) ---------- */
function runVisionAnalysis(){
  const box = document.getElementById('vision-results');
  if (!box) return;
  const html = `
    <div class="mb-1"><b>Detected brands:</b> Peet's, Caf√© Bustelo, Tim Hortons (approx.)</div>
    <table class="w-full text-xs mt-1">
      <thead><tr><th class="text-left">Brand / Variety</th><th class="text-left">Approx. Facings</th><th class="text-left">Shelf Position</th></tr></thead>
      <tbody>
        <tr><td>Peet's ‚Äì Major Dickason's</td><td>4‚Äì5</td><td>center-left, row 2</td></tr>
        <tr><td>Caf√© Bustelo ‚Äì Espresso</td><td>3</td><td>lower row</td></tr>
        <tr><td>Tim Hortons ‚Äì Original</td><td>2</td><td>upper row</td></tr>
      </tbody>
    </table>
    <p class="mt-2 text-xs text-gray-600">Note: demo-only approximations. OCR/pricing not enabled in MVP ‚Äî use manual price field.</p>
  `;
  box.innerHTML = html;
  try { localStorage.setItem('sa_last_analysis_html', html); } catch(e){}
}
function injectReportAnalysis(){
  const ana = localStorage.getItem('sa_last_analysis_html');
  const box = document.getElementById('report-analysis');
  if (ana && box) box.innerHTML = ana;
}

/* ---------- Client Snapshot helpers ---------- */
function buildReportFromState(){
  const brand = localStorage.getItem(SA.brandKey) || '‚Äî';
  const store = localStorage.getItem(SA.storeKey) || '‚Äî';
  const price = localStorage.getItem(SA.priceKey);
  const when = localStorage.getItem(SA.submittedAtKey);
  const photo = localStorage.getItem(SA.photoKey);
  const fmt = when ? (new Date(parseInt(when,10))).toLocaleString() : '‚Äî';

  const set = (id,val)=>{ const el=document.getElementById(id); if (el) el.textContent = val; };
  set('report-brand', brand);
  set('report-store', store);
  set('report-price', price ? ('$'+normalizePrice(price)) : '‚Äî');
  set('report-date', fmt);

  const box = document.getElementById('report-photos');
  if (box){
    box.innerHTML = '';
    if (photo && photo !== 'demo'){
      const img = document.createElement('img');
      img.src = photo;
      img.className = 'w-full h-24 object-cover rounded';
      box.appendChild(img);
    } else {
      const ph = document.createElement('div');
      ph.className = 'w-full h-24 rounded bg-gray-200 flex items-center justify-center text-gray-500';
      ph.textContent = 'No photo';
      box.appendChild(ph);
    }
  }
}

/* ---------- Jobs map toggle ---------- */
let _liveMap = false;
function toggleMapMode(){
  _liveMap = !_liveMap;
  document.getElementById('map-static')?.classList.toggle('hidden', _liveMap);
  document.getElementById('map-live')?.classList.toggle('hidden', !_liveMap);
}

/* ---------- Jobs pool (for Create Job form) ---------- */
function getJobsPool(){ try { return JSON.parse(localStorage.getItem('sa_jobs_pool')||'[]'); } catch(e){ return []; } }
function setJobsPool(arr){ try { localStorage.setItem('sa_jobs_pool', JSON.stringify(arr||[])); } catch(e){} }
function renderJobsPool(){
  const mount = document.getElementById('jobs-dynamic');
  if (!mount) return;
  const jobs = getJobsPool();
  mount.innerHTML = '';
  if (!jobs.length) return;

  // Group by store
  const groups = {};
  jobs.forEach(j=>{
    const key = j.store || 'Other';
    if (!groups[key]) groups[key] = [];
    groups[key].push(j);
  });

  Object.keys(groups).forEach(store => {
    const head = document.createElement('div');
    head.className = 'bg-gray-200 p-3 rounded text-sm font-medium text-gray-700';
    head.textContent = store;
    mount.appendChild(head);

    groups[store].forEach(job => {
      const card = document.createElement('div');
      card.className = 'job-box p-4 rounded-xl shadow cursor-pointer hover:shadow-lg';
      card.innerHTML = `<p class="font-bold">${job.brand||'New Product'}</p>
                        <p class="text-sm text-gray-500 mt-1">Take and upload 2 photos</p>
                        <p class="text-sm font-semibold text-[var(--sa-gold)] mt-2">Earn $${((job.payoutCents||300)/100).toFixed(2)}</p>`;
      card.onclick = () => {
        try {
          localStorage.setItem('sa_current_job_brand', job.brand||'');
          localStorage.setItem('sa_current_job_store', job.store||'');
          localStorage.setItem('sa_current_job_payout', String(job.payoutCents||300));
          localStorage.setItem('sa_current_job_notes', job.notes||'');
        } catch(e){}
        showLocationModal(job.store||'Unknown store');
      };
      mount.appendChild(card);
    });
  });
}
function publishJob(){
  const brand = (document.getElementById('cj-brand')?.value||'').trim();
  const store = (document.getElementById('cj-store')?.value||'').trim();
  const notes = (document.getElementById('cj-notes')?.value||'').trim();
  const type = (document.querySelector('input[name="cj-type"]:checked')||{}).value || 'standard';
  if (!brand || !store){ alert('Please fill in Product/Brand and Store.'); return; }
  let payout = 300;
  if (type === 'launch') payout = 1200;
  if (type === 'rush') payout = 600;
  const jobs = getJobsPool();
  jobs.push({ id:`job_${Date.now()}`, brand, store, notes, type, payoutCents:payout });
  setJobsPool(jobs);
  try {
    localStorage.setItem('sa_current_job_brand', brand);
    localStorage.setItem('sa_current_job_store', store);
    localStorage.setItem('sa_current_job_payout', String(payout));
    localStorage.setItem('sa_current_job_notes', notes);
  } catch(e){}
  scrollToScreen('screen4');
  setTimeout(renderJobsPool, 100);
  alert('Job published! It now appears in Jobs Near You.');
}
function updateJobDetailsUI(){
  const brand = localStorage.getItem('sa_current_job_brand') || 'Rambler Sparkling Water';
  const store = localStorage.getItem('sa_current_job_store') || localStorage.getItem(SA.storeKey) || 'Whole Foods Market';
  const payout = parseInt(localStorage.getItem('sa_current_job_payout')||'300',10);

  const titleEl = document.getElementById('job-title');
  const storeEl = document.getElementById('job-store');
  const payEl = document.getElementById('job-payout');
  if (titleEl) titleEl.textContent = brand;
  if (storeEl) storeEl.textContent = store;
  if (payEl) payEl.textContent = '$'+(payout/100).toFixed(2);
}

/* ---------- Client UI sync ---------- */
function syncClientUI(){
  const rp = document.getElementById('reported-price');
  const rpl = document.getElementById('reported-price-location');
  const price = localStorage.getItem(SA.priceKey);
  const store = localStorage.getItem(SA.storeKey);
  if (rp) rp.textContent = price ? normalizePrice(price) : '‚Äî';
  if (rpl) rpl.textContent = store || 'Location pending';
  // earnings on dashboard
  const cents = parseInt(localStorage.getItem(SA.earningsKey)||'1500',10);
  const ti = document.getElementById('total-income');
  if (ti) ti.textContent = '$' + (cents/100).toFixed(2);
}

/* ---------- Admin mode ---------- */
function enableAdminMode(){
  try { localStorage.setItem(SA.adminKey,'1'); } catch(e){}
  document.getElementById('quick-nav')?.classList.add('show');
  scrollToScreen('screen14');
}
function restoreAdminMode(){
  const v = localStorage.getItem(SA.adminKey);
  if (v === '1'){ document.getElementById('quick-nav')?.classList.add('show'); }
}

/* ---------- Init ---------- */
function initState(){
  if (localStorage.getItem(SA.earningsKey) === null) localStorage.setItem(SA.earningsKey,'1500');
  if (localStorage.getItem(SA.jobsKey) === null) localStorage.setItem(SA.jobsKey,'2');
  renderJobsPool();
  syncClientUI();
  restoreAdminMode();
  // prime default dynamic job for demo
  if (!getJobsPool().length){
    setJobsPool([
      {id:'job_demo1', brand:'Neutral Milk', store:'Whole Foods Market - 10133 Louetta Rd, Houston, TX 77070', notes:'Tag photo + shelf section', type:'standard', payoutCents:300},
      {id:'job_demo2', brand:'RIND Snacks', store:'H‚ÄëE‚ÄëB - 20017 Bridgeland Creek Pkwy, Cypress, TX 77433', notes:'3 photos incl. price tag', type:'rush', payoutCents:300},
    ]);
    renderJobsPool();
  }
}
document.addEventListener('DOMContentLoaded', initState);
</script>

<style>
@media print {
  body * { visibility: hidden; }
  #screen19, #screen19 * { visibility: visible; }
  #screen19 { position: absolute; inset: 0; width: 100%; }
}
</style>

<script id="sa-button-autopatch">
  (function(){
    function patchButtons(){
      var btns = document.querySelectorAll('button');
      btns.forEach(function(b){
        if (!b.classList.contains('sa-btn')){
          b.classList.add('sa-btn');
        }
        if (!b.getAttribute('type')){
          b.setAttribute('type','button');
        }
      });
    }
    if (document.readyState === 'loading'){
      document.addEventListener('DOMContentLoaded', patchButtons);
    } else {
      patchButtons();
    }
  })();
</script>

</body>
</html>
