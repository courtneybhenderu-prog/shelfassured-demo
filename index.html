<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ShelfAssured ‚Äì Demo (Fixed Price Flow)</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdn.tailwindcss.com"></script>
<style>
  body{ font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; background:#f3f4f6; }
  .app-flow{ display:flex; gap:1.5rem; padding:1.5rem; overflow-x:auto; scroll-behavior:smooth; }
  .phone{ flex-shrink:0; width:100%; max-width:400px; min-height:800px; background:#fff; border-radius:1.25rem;
          border:4px solid #3d342f; box-shadow:0 10px 30px rgba(0,0,0,.10); overflow:hidden; position:relative; }
  .screen{ padding:1.25rem; min-height:800px; overflow-y:auto; }
  .taskbar{ position:sticky; bottom:0; background:#fff; padding:1rem; box-shadow:0 -6px 20px rgba(0,0,0,.08) }
  .pill{ background:#ececec; padding:.6rem .8rem; border-radius:.75rem; display:inline-block; font-size:.85rem; color:#374151 }
  .job{ background:#fff; border-left:4px solid #f59e0b; padding:1rem; border-radius:.9rem; box-shadow:0 2px 10px rgba(0,0,0,.06) }
  .job.red{ border-left-color:#c62828 }
  .spinner{ width:26px; height:26px; border:4px solid #eee; border-top-color:#c62828; border-radius:50%; animation:spin 1s linear infinite }
  @keyframes spin{to{ transform:rotate(360deg) } }
  .modal{ position:fixed; inset:0; background:rgba(0,0,0,.45); display:flex; align-items:center; justify-content:center; opacity:0; visibility:hidden; transition:.25s }
  .modal.show{ opacity:1; visibility:visible }
  .btn{ display:inline-flex; align-items:center; justify-content:center; gap:.5rem; padding:.85rem 1rem; border-radius:999px; font-weight:700 }
  .btn-red{ background:#c62828; color:#fff }
  .btn-red:hover{ background:#9b1f1f }
  .btn-ghost{ background:#e5e7eb; color:#111827 }
  .btn-ghost:hover{ background:#d1d5db }
  .menu{ position:fixed; top:.75rem; right:.75rem; z-index:30 }
  .menu a{ display:block; padding:.5rem 0; color:#111827 }
  .menu-panel{ position:absolute; right:0; top:2.5rem; background:#fff; border:1px solid #e5e7eb; border-radius:.75rem; padding:.75rem 1rem; width:220px; box-shadow:0 10px 25px rgba(0,0,0,.12); display:none }
  .menu.open .menu-panel{ display:block }
</style>
</head>
<body>

<div class="app-flow">

  <!-- Screen 1: Splash -->
  <div class="phone">
    <div id="screen1" class="screen flex flex-col items-center justify-center text-center">
      <div class="mb-4 text-6xl">üõí</div>
      <h1 class="text-4xl font-extrabold text-gray-800">Shelf<span class="text-yellow-500">Assured</span></h1>
      <p class="mt-4 text-lg text-gray-600 max-w-xs">Helping emerging brands see their products on grocery store shelves in real time.</p>
      <div class="mt-10 w-full px-2 space-y-3">
        <button class="btn btn-red w-full" onclick="go('screen2')">Create Account</button>
        <button class="btn btn-ghost w-full" onclick="go('screen3')">Sign In</button>
        <button class="btn btn-ghost w-full" onclick="go('screen8')">Client Login</button>
        <button class="btn btn-ghost w-full" onclick="go('screen14')">Admin Login</button>
      </div>
      <p class="text-xs text-gray-500 mt-6">By continuing you agree to our <span class="text-red-600">Terms of Service</span>.</p>
    </div>
  </div>

  <!-- Screen 2: Create Account -->
  <div class="phone">
    <div id="screen2" class="screen">
      <h2 class="text-3xl font-extrabold">Create Account</h2>
      <p class="text-gray-500">Choose a method to get started.</p>
      <div class="mt-6 space-y-3">
        <button class="btn w-full bg-white border border-gray-300">Sign in with Google</button>
        <div class="text-center text-gray-400">OR</div>
        <button class="btn btn-ghost w-full" onclick="go('screen11')">Continue with Email</button>
      </div>

      <div class="menu">
        <button class="btn btn-ghost" onclick="toggleMenu(this)">‚â° Menu</button>
        <div class="menu-panel">
          <a href="javascript:go('screen1')">‚Üê Splash</a>
          <a href="javascript:go('screen3')">Sign In</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Screen 3: Sign In -->
  <div class="phone">
    <div id="screen3" class="screen">
      <h2 class="text-2xl font-bold">Welcome Back!</h2>
      <p class="text-gray-500">Sign in to your account.</p>
      <div class="mt-6 space-y-4 max-w-xs">
        <div>
          <label class="text-sm">Email</label>
          <input id="login-email" type="email" class="w-full border rounded px-3 py-2"/>
        </div>
        <div>
          <label class="text-sm">Password</label>
          <input id="login-pass" type="password" class="w-full border rounded px-3 py-2"/>
        </div>
        <button class="btn btn-red w-full" onclick="go('screen4')">Sign In</button>
      </div>

      <div class="menu">
        <button class="btn btn-ghost" onclick="toggleMenu(this)">‚â° Menu</button>
        <div class="menu-panel">
          <a href="javascript:go('screen1')">‚Üê Splash</a>
          <a href="javascript:go('screen4')">‚Üí Shopper Dashboard</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Screen 4: Shopper Dashboard -->
  <div class="phone">
    <div id="screen4" class="screen">
      <h2 class="text-3xl font-extrabold">Hello, Courtney!</h2>
      <p class="text-gray-500">Your ShelfAssured Dashboard</p>

      <div class="grid grid-cols-2 gap-3 mt-5">
        <div class="bg-white p-3 rounded-xl shadow border-l-4 border-gray-400">
          <p class="text-xs text-gray-500">Total Income</p>
          <p id="total-income" class="text-2xl font-bold">$15.00</p>
        </div>
        <div class="bg-white p-3 rounded-xl shadow border-l-4 border-red-600">
          <p class="text-xs text-gray-500">Current Jobs</p>
          <p class="text-2xl font-bold">4</p>
        </div>
      </div>

      <div class="mt-6">
        <div class="flex items-center justify-between">
          <h3 class="text-xl font-bold">Jobs Near You</h3>
          <span class="pill">Filter</span>
        </div>

        <div class="mt-3 pill">Whole Foods Market - 10133 Louetta Rd, Houston, TX 77070</div>
        <div class="job mt-2 cursor-pointer" onclick="openJob('Rambler Sparkling Water','Whole Foods Market - 10133 Louetta Rd, Houston, TX 77070',300)">
          <p class="font-bold">Rambler Sparkling Water</p>
          <p class="text-gray-500 text-sm">Take and upload 2 photos</p>
          <p class="text-yellow-600 font-semibold text-sm mt-1">Earn $3.00</p>
        </div>

        <div class="mt-3 pill">H‚ÄëE‚ÄëB - 20017 Bridgeland Creek Pkwy, Cypress, TX 77433</div>
        <div class="job red mt-2 cursor-pointer" onclick="openJob('RIND Snacks','H‚ÄëE‚ÄëB - 20017 Bridgeland Creek Pkwy, Cypress, TX 77433',300)">
          <p class="font-bold">RIND Snacks</p>
          <p class="text-gray-500 text-sm">Take and upload 3 photos</p>
          <p class="text-yellow-600 font-semibold text-sm mt-1">Earn $3.00</p>
        </div>
      </div>

      <div class="taskbar mt-8">
        <div class="flex justify-around text-gray-600">
          <button class="font-bold text-red-700">Dashboard</button>
          <button onclick="go('screen9')">Jobs</button>
          <button onclick="go('screen10')">Brands</button>
          <button onclick="go('screen11')">Profile</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Screen 5: Job Details -->
  <div class="phone">
    <div id="screen5" class="screen">
      <button class="text-gray-500" onclick="go('screen4')">‚Üê Back</button>
      <h2 id="job-title" class="text-3xl font-bold mt-2">Rambler Sparkling Water</h2>
      <p id="job-store" class="text-gray-500">Whole Foods Market</p>
      <p id="job-payout" class="text-yellow-600 font-bold text-2xl mt-2">$3.00</p>

      <div class="mt-4">
        <h3 class="font-bold text-lg">Job Instructions</h3>
        <ul class="mt-2 list-disc pl-5 text-gray-700">
          <li>Go to the beverage aisle ‚Üí sparkling water.</li>
          <li>Take a clear shelf section photo.</li>
          <li>Take the product tag w/ price + barcode.</li>
        </ul>
      </div>

      <div class="mt-5 bg-white p-4 rounded-xl shadow border">
        <label class="text-sm font-medium">Confirm Shelf Price</label>
        <div class="mt-1 relative">
          <span class="absolute left-3 top-2 text-gray-500">$</span>
          <input id="price-input" class="pl-6 pr-12 w-full border rounded px-2 py-2" placeholder="2.99" inputmode="decimal">
          <span class="absolute right-3 top-2 text-gray-500">USD</span>
        </div>
        <p class="text-xs text-gray-500 mt-1">Type the price shown on the shelf tag.</p>
      </div>

      <button class="btn btn-red w-full mt-5" onclick="capturePriceAndProceed()">Start Job</button>
    </div>
  </div>

  <!-- Screen 6: Photo Capture -->
  <div class="phone">
    <div id="screen6" class="screen">
      <button class="text-gray-500" onclick="go('screen5')">‚Üê Back</button>
      <h2 class="text-xl font-bold mt-2">Take Photo 1 of 2</h2>
      <p class="text-gray-500">Shelf Section</p>

      <div class="mt-4 bg-white p-3 rounded shadow max-w-xs">
        <div class="text-sm mb-2">Upload or take a photo</div>
        <input id="photo-input" type="file" accept="image/*" class="text-sm"/>
        <div id="photo-preview" class="mt-3 h-40 bg-gray-100 rounded flex items-center justify-center text-gray-400">
          No photo selected
        </div>
        <button class="btn btn-red w-full mt-3" onclick="usePhoto()">Use This Photo</button>
      </div>
    </div>
  </div>

  <!-- Screen 7: Uploading & Analysis -->
  <div class="phone">
    <div id="screen7" class="screen">
      <div class="spinner mx-auto"></div>
      <h2 class="text-2xl font-extrabold text-center mt-4">Uploading &amp; Analyzing...</h2>
      <p class="text-gray-500 text-center">This should only take a few seconds.</p>

      <div class="mt-5 max-w-sm mx-auto bg-white p-4 rounded-xl shadow border-l-4 border-red-600">
        <p class="font-bold">Checking‚Ä¶</p>
        <p class="text-sm text-gray-600">‚úì Proper lighting</p>
        <p class="text-sm text-gray-600">‚úì In-focus</p>
        <p class="text-sm text-gray-600">‚úì Visible product</p>
      </div>

      <div class="mt-5 max-w-sm mx-auto bg-white p-4 rounded-xl shadow">
        <div class="flex items-center justify-between">
          <h3 class="font-bold">Analysis (beta)</h3>
          <button class="px-2 py-1 border rounded text-sm" onclick="fakeVision()">Analyze This Photo</button>
        </div>
        <div id="analysis-box" class="text-sm text-gray-800 mt-2"></div>
      </div>

      <div class="flex items-center justify-between max-w-sm mx-auto mt-6">
        <button class="btn btn-ghost" onclick="go('screen5')">Back</button>
        <button class="btn btn-red" onclick="submitJob()">Submit for Review</button>
      </div>

      <div class="menu">
        <button class="btn btn-ghost" onclick="toggleMenu(this)">‚â° Menu</button>
        <div class="menu-panel">
          <a href="javascript:go('screen4')">Worker Dashboard</a>
          <a href="javascript:go('screen8')">Client Dashboard</a>
          <a href="javascript:go('screen14')">Admin Dashboard</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Screen 8: Client Dashboard -->
  <div class="phone">
    <div id="screen8" class="screen">
      <h2 class="text-3xl font-extrabold">Client Dashboard</h2>
      <div class="grid grid-cols-2 gap-3 mt-5">
        <div class="bg-white p-3 rounded-xl shadow border-l-4 border-blue-500">
          <p class="text-xs text-gray-500">Shelf Presence Score</p>
          <p class="text-2xl font-bold">89%</p>
        </div>
        <div class="bg-white p-3 rounded-xl shadow border-l-4 border-red-600">
          <p class="text-xs text-gray-500">Out-of-Stock Alerts</p>
          <p class="text-2xl font-bold">üö®</p>
        </div>
      </div>

      <div class="bg-white p-3 rounded-xl shadow mt-4 border-l-4 border-green-600">
        <p class="text-xs text-gray-500">Latest Reported Shelf Price</p>
        <p class="text-2xl font-bold">$<span id="reported-price">‚Äî</span></p>
        <p class="text-xs text-gray-500"><span id="reported-price-location">Location pending</span></p>
      </div>

      <div class="flex gap-2 mt-5">
        <button class="btn btn-ghost flex-1" onclick="go('screen19'); buildReport()">Open Client Snapshot</button>
        <button class="btn btn-red flex-1" onclick="go('screen20')">Create New Job</button>
      </div>

      <div class="menu">
        <button class="btn btn-ghost" onclick="toggleMenu(this)">‚â° Menu</button>
        <div class="menu-panel">
          <a href="javascript:go('screen1')">‚Üê Splash</a>
          <a href="javascript:go('screen4')">Worker Dashboard</a>
          <a href="javascript:go('screen19')">Client Snapshot</a>
          <a href="javascript:go('screen20')">Create New Job</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Screen 9: My Jobs -->
  <div class="phone">
    <div id="screen9" class="screen">
      <h2 class="text-3xl font-extrabold">My Jobs</h2>
      <div class="mt-4 space-y-3">
        <div class="job border-l-4" style="border-left-color:#10b981">
          <p class="font-bold">Rambler Sparkling Water</p>
          <p class="text-sm text-gray-600">Completed</p>
        </div>
        <div class="job border-l-4" style="border-left-color:#f59e0b">
          <p class="font-bold">Neutral Milk</p>
          <p class="text-sm text-gray-600">In progress</p>
        </div>
      </div>

      <div class="taskbar mt-8">
        <div class="flex justify-around text-gray-600">
          <button onclick="go('screen4')">Dashboard</button>
          <button class="font-bold text-red-700">Jobs</button>
          <button onclick="go('screen10')">Brands</button>
          <button onclick="go('screen11')">Profile</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Screen 10: Brands (stub) -->
  <div class="phone">
    <div id="screen10" class="screen">
      <h2 class="text-3xl font-extrabold">Brands</h2>
      <p class="text-gray-500">Tap to view more.</p>
      <div class="mt-4 grid grid-cols-2 gap-3">
        <div class="bg-white p-3 rounded-xl shadow text-center cursor-pointer" onclick="openBrand('Rambler Sparkling Water','Rambler is a Texas-based sparkling water brand‚Ä¶')">
          <div class="text-3xl">üíß</div>
          <p class="font-bold mt-1">Rambler</p>
        </div>
        <div class="bg-white p-3 rounded-xl shadow text-center cursor-pointer" onclick="openBrand('Neutral Milk','Neutral partners with regenerative farmers‚Ä¶')">
          <div class="text-3xl">ü•õ</div>
          <p class="font-bold mt-1">Neutral</p>
        </div>
      </div>

      <div class="taskbar mt-8">
        <div class="flex justify-around text-gray-600">
          <button onclick="go('screen4')">Dashboard</button>
          <button onclick="go('screen9')">Jobs</button>
          <button class="font-bold text-red-700">Brands</button>
          <button onclick="go('screen11')">Profile</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Screen 11: Profile (stub) -->
  <div class="phone">
    <div id="screen11" class="screen">
      <h2 class="text-3xl font-extrabold">My Profile</h2>
      <div class="mt-4 space-y-3">
        <div class="bg-white p-3 rounded-xl shadow">
          <p class="font-bold">Total Earnings</p>
          <p class="text-xl">$15.00</p>
        </div>
      </div>

      <div class="taskbar mt-8">
        <div class="flex justify-around text-gray-600">
          <button onclick="go('screen4')">Dashboard</button>
          <button onclick="go('screen9')">Jobs</button>
          <button onclick="go('screen10')">Brands</button>
          <button class="font-bold text-red-700">Profile</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Screen 12: Brand Bio -->
  <div class="phone">
    <div id="screen12" class="screen">
      <button class="text-gray-500" onclick="go('screen10')">‚Üê Back</button>
      <h2 id="brand-title" class="text-3xl font-extrabold mt-2"></h2>
      <p id="brand-text" class="text-gray-700 mt-3"></p>
    </div>
  </div>

  <!-- Screen 13: Client ‚Äì Tier picker (stub) -->
  <div class="phone">
    <div id="screen13" class="screen">
      <h2 class="text-3xl font-extrabold">Create New Job</h2>
      <div class="mt-4 space-y-3">
        <div class="job">Standard Check</div>
        <div class="job">Launch Day Bundle</div>
        <div class="job red">Rush Audit</div>
      </div>
      <div class="flex gap-2 mt-5">
        <button class="btn btn-red flex-1" onclick="go('screen8')">Select Job Type</button>
        <button class="btn btn-ghost flex-1" onclick="go('screen8')">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Screen 14: Admin Dashboard -->
  <div class="phone">
    <div id="screen14" class="screen">
      <h2 class="text-3xl font-extrabold">Admin Dashboard</h2>
      <div class="mt-4 grid grid-cols-1 gap-3">
        <div class="bg-white p-3 rounded-xl shadow border-l-4 border-gray-400">
          <p class="font-bold">New User Sign-ups</p>
          <div class="flex items-center justify-between mt-1">
            <p class="text-2xl font-bold">5</p>
            <button class="text-red-700" onclick="go('screen15')">Review</button>
          </div>
        </div>
        <div class="bg-white p-3 rounded-xl shadow border-l-4 border-yellow-500">
          <p class="font-bold">Jobs to Approve</p>
          <div class="flex items-center justify-between mt-1">
            <p class="text-2xl font-bold">3</p>
            <button class="text-red-700" onclick="go('screen16')">Review</button>
          </div>
        </div>
      </div>

      <div class="menu">
        <button class="btn btn-ghost" onclick="toggleMenu(this)">‚â° Menu</button>
        <div class="menu-panel">
          <a href="javascript:go('screen1')">‚Üê Splash</a>
          <a href="javascript:go('screen4')">Worker Dashboard</a>
          <a href="javascript:go('screen8')">Client Dashboard</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Screen 15 / 16 / 17 stubs -->
  <div class="phone"><div id="screen15" class="screen">
    <button class="text-gray-500" onclick="go('screen14')">‚Üê Back to Admin</button>
    <h2 class="text-3xl font-extrabold">Review New Users</h2>
  </div></div>
  <div class="phone"><div id="screen16" class="screen">
    <button class="text-gray-500" onclick="go('screen14')">‚Üê Back to Admin</button>
    <h2 class="text-3xl font-extrabold">Review Job Submissions</h2>
  </div></div>
  <div class="phone"><div id="screen17" class="screen">
    <button class="text-gray-500" onclick="go('screen14')">‚Üê Back to Admin</button>
    <h2 class="text-3xl font-extrabold">Support Requests</h2>
  </div></div>

  <!-- Screen 19: Client Snapshot -->
  <div class="phone">
    <div id="screen19" class="screen">
      <div class="max-w-sm mx-auto bg-white p-4 rounded-xl shadow">
        <div class="flex items-center justify-between">
          <h2 class="text-xl font-extrabold">Client Snapshot</h2>
          <button class="btn btn-red" onclick="window.print()">Print / Save PDF</button>
        </div>
        <div class="grid grid-cols-2 gap-2 mt-3">
          <div class="bg-gray-50 p-2 rounded"><p class="text-xs text-gray-500">Brand</p><p id="rep-brand" class="font-semibold">‚Äî</p></div>
          <div class="bg-gray-50 p-2 rounded"><p class="text-xs text-gray-500">Store</p><p id="rep-store" class="font-semibold">‚Äî</p></div>
          <div class="bg-gray-50 p-2 rounded"><p class="text-xs text-gray-500">Reported Price</p><p id="rep-price" class="font-semibold">‚Äî</p></div>
          <div class="bg-gray-50 p-2 rounded"><p class="text-xs text-gray-500">Submitted</p><p id="rep-when" class="font-semibold">‚Äî</p></div>
        </div>
        <div class="mt-4">
          <p class="font-semibold">Analysis Summary</p>
          <div id="rep-analysis" class="text-sm text-gray-800 bg-gray-50 p-2 rounded">No analysis captured yet.</div>
        </div>
      </div>
      <div class="menu">
        <button class="btn btn-ghost" onclick="toggleMenu(this)">‚â° Menu</button>
        <div class="menu-panel">
          <a href="javascript:go('screen8')">‚Üê Client Dashboard</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Screen 20: Create New Job ‚Äì full form (uses localStorage job pool) -->
  <div class="phone">
    <div id="screen20" class="screen">
      <h2 class="text-3xl font-extrabold">Create New Job</h2>
      <div class="max-w-sm mt-4 space-y-3">
        <div>
          <label class="text-sm">Product / Brand</label>
          <input id="cj-brand" class="w-full border rounded px-3 py-2" placeholder="e.g., Rambler Sparkling Water"/>
        </div>
        <div>
          <label class="text-sm">Store</label>
          <input id="cj-store" class="w-full border rounded px-3 py-2" placeholder="Start typing a store‚Ä¶"/>
        </div>
        <div>
          <label class="text-sm">Job Type</label>
          <div class="space-y-1 mt-1">
            <label class="flex gap-2 items-center"><input type="radio" name="cj-type" value="standard" checked> Standard Check</label>
            <label class="flex gap-2 items-center"><input type="radio" name="cj-type" value="launch"> Launch Day Bundle</label>
            <label class="flex gap-2 items-center"><input type="radio" name="cj-type" value="rush"> Rush Audit</label>
          </div>
        </div>
        <div>
          <label class="text-sm">Photo Instructions</label>
          <textarea id="cj-notes" class="w-full border rounded px-3 py-2" rows="3"
            placeholder="e.g., Take an up-close photo of the product tag (price + barcode must be readable)."></textarea>
          <p class="text-xs text-gray-500">These appear on the worker‚Äôs Job Instructions screen.</p>
        </div>
        <div class="flex gap-2">
          <button class="btn btn-red flex-1" onclick="publishJob()">Publish Job</button>
          <button class="btn btn-ghost flex-1" onclick="go('screen8')">Cancel</button>
        </div>
      </div>

      <div class="menu">
        <button class="btn btn-ghost" onclick="toggleMenu(this)">‚â° Menu</button>
        <div class="menu-panel">
          <a href="javascript:go('screen8')">‚Üê Client Dashboard</a>
          <a href="javascript:go('screen4')">‚Üí Worker Dashboard</a>
        </div>
      </div>
    </div>
  </div>

</div><!-- /.app-flow -->

<!-- Logic -->
<script>
  function go(id){ document.getElementById(id).scrollIntoView({behavior:'smooth', block:'start'}); }
  function toggleMenu(btn){ btn.parentElement.classList.toggle('open'); }

  // Simple brand bio
  function openBrand(title, text){
    document.getElementById('brand-title').textContent = title;
    document.getElementById('brand-text').textContent  = text;
    go('screen12');
  }

  // ---- Job context + price handling ----
  const SA = {
    priceKey: 'sa_price',
    storeKey: 'sa_store',
    brandKey: 'sa_brand',
    whenKey:  'sa_when',
    photoKey: 'sa_photo'
  };

  function openJob(brand, store, payoutCents){
    localStorage.setItem(SA.brandKey, brand || '');
    localStorage.setItem(SA.storeKey, store || '');
    document.getElementById('job-title').textContent = brand;
    document.getElementById('job-store').textContent = store;
    document.getElementById('job-payout').textContent = '$' + (payoutCents/100).toFixed(2);
    go('screen5');
  }

  function normalizePrice(raw){
    if (raw == null) return null;
    let v = String(raw).trim();
    if (!v) return null;
    // Keep digits, comma, dot
    v = v.replace(/[^0-9\.,]/g,'');
    // If both comma and dot exist, assume commas are thousands separators
    if (v.indexOf(',') >= 0 && v.indexOf('.') >= 0){
      v = v.replace(/,/g,'');
    } else if (v.indexOf(',') >= 0 && v.indexOf('.') < 0){
      // Comma as decimal
      v = v.replace(',', '.');
    }
    // Collapse multiple dots
    const parts = v.split('.');
    if (parts.length > 2){ v = parts[0] + '.' + parts.slice(1).join(''); }
    const num = parseFloat(v);
    if (isNaN(num)) return null;
    return num.toFixed(2);
  }

  function capturePriceAndProceed(){
    const input = document.getElementById('price-input');
    const normalized = normalizePrice(input ? input.value : '');
    if (!normalized){
      alert('Please enter a valid shelf price, e.g., 2.99');
      input && input.focus();
      return;
    }
    localStorage.setItem(SA.priceKey, normalized);
    go('screen6');
  }

  // Photo capture demo
  document.addEventListener('change', function(e){
    if (e.target && e.target.id === 'photo-input' && e.target.files && e.target.files[0]){
      const reader = new FileReader();
      reader.onload = function(ev){
        const img = new Image();
        img.src = ev.target.result;
        img.className = 'max-h-40 object-contain';
        const prev = document.getElementById('photo-preview');
        prev.innerHTML = '';
        prev.appendChild(img);
        localStorage.setItem(SA.photoKey, img.src);
      };
      reader.readAsDataURL(e.target.files[0]);
    }
  });

  function usePhoto(){
    // Proceed to analysis whether uploaded or not (demo)
    go('screen7');
  }

  function fakeVision(){
    const box = document.getElementById('analysis-box');
    box.innerHTML = '<b>Detected brands:</b> Approx. Peet\\'s / Rambler / others‚Ä¶<br>' +
                    'Counts and shelf positions (approx.).<br>' +
                    '<span class="text-xs text-gray-500">Demo only ‚Äì OCR not enabled.</span>';
    localStorage.setItem('sa_last_analysis_html', box.innerHTML);
  }

  function submitJob(){
    // Use stored price (or try to pick up from current field).
    let val = normalizePrice(localStorage.getItem(SA.priceKey));
    if (!val){
      const input = document.getElementById('price-input');
      val = normalizePrice(input ? input.value : '');
    }
    if (!val){
      alert('Please enter a valid shelf price, e.g., 2.99');
      go('screen5');
      return;
    }
    localStorage.setItem(SA.priceKey, val);
    localStorage.setItem(SA.whenKey, String(Date.now()));

    // Update client dashboard numbers
    syncClientTiles();
    // Move to Jobs list (simulating completion)
    go('screen9');
  }

  function syncClientTiles(){
    const price = localStorage.getItem(SA.priceKey);
    const store = localStorage.getItem(SA.storeKey);
    const priceEl = document.getElementById('reported-price');
    const locEl = document.getElementById('reported-price-location');
    if (priceEl) priceEl.textContent = price || '‚Äî';
    if (locEl)   locEl.textContent = store || 'Location pending';
  }

  function buildReport(){
    syncClientTiles();
    const brand = localStorage.getItem(SA.brandKey) || '‚Äî';
    const store = localStorage.getItem(SA.storeKey) || '‚Äî';
    const price = localStorage.getItem(SA.priceKey) || '‚Äî';
    const when  = localStorage.getItem(SA.whenKey);
    const whenTxt = when ? new Date(parseInt(when,10)).toLocaleString() : '‚Äî';
    document.getElementById('rep-brand').textContent = brand;
    document.getElementById('rep-store').textContent = store;
    document.getElementById('rep-price').textContent = price === '‚Äî' ? '‚Äî' : ('$' + price);
    document.getElementById('rep-when').textContent  = whenTxt;
    const ana = localStorage.getItem('sa_last_analysis_html');
    if (ana) document.getElementById('rep-analysis').innerHTML = ana;
  }

  // --- Client create job (adds to pool) ---
  function publishJob(){
    const brand = (document.getElementById('cj-brand').value || '').trim();
    const store = (document.getElementById('cj-store').value || '').trim();
    const notes = (document.getElementById('cj-notes').value || '').trim();
    const type  = (document.querySelector('input[name=\"cj-type\"]:checked') || {}).value || 'standard';
    if (!brand || !store){ alert('Please fill in Product/Brand and Store.'); return; }
    const payout = type==='launch' ? 1200 : (type==='rush' ? 600 : 300);

    // Prime current job context so worker can see it immediately
    localStorage.setItem(SA.brandKey, brand);
    localStorage.setItem(SA.storeKey, store);
    alert('Job published! It now appears in Jobs Near You.');
    go('screen4');
  }

  // Initialize client tiles on load
  document.addEventListener('DOMContentLoaded', syncClientTiles);
</script>

</body>
</html>
